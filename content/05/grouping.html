
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Granularity: &#8212; Data Science in Practice</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Understanding Aggregations" href="understanding-aggregations.html" />
    <link rel="prev" title="Aggregation and Extension of Data" href="introduction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/toolbox.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science in Practice</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Data Science in Practice
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 1: Understanding Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/introduction.html">
   1. Introduction to Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/what-is-data-science.html">
     1.1. What is Data Science?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/scientific-method.html">
     1.2. The Scientific Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/data-science-example.html">
     1.3. A Data Science Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/introduction.html">
   2. Tabular Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/tabular-data.html">
     2.1. Introduction to Tabular Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/methods.html">
     2.2. DataFrame Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data-types.html">
     2.3. Data Types and Performance
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/introduction.html">
   3. Querying and Describing Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/selecting-data.html">
     3.1. Selecting Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/kinds-of-data.html">
     3.2. Kinds of Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/categorical-distributions.html">
     3.3. Categorical Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/quantitative-distributions.html">
     3.4. Quantitative Distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/introduction.html">
   4. Understanding Assumptions and Data Cleaning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modifying-dataframes.html">
     4.1. Modifying DataFrames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cleaning.html">
     4.2. Cleaning Messy Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/eda.html">
     4.3. Exploratory Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/asking-questions.html">
     4.4. Hypothesis Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="introduction.html">
   5. Aggregation and Extension of Data
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.1. Data Granularity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="understanding-aggregations.html">
     5.2. Understanding Aggregations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="appending-data.html">
     5.3. Combining Data (Observations)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="joining-data.html">
     5.4. Combining Data (Attributes)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="permutation-tests.html">
     5.5. Permutation Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="eda-2.html">
     5.6. Exploratory Data Analysis II
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/introduction.html">
   6. Missing Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/defining-missing.html">
     6.1. Definitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/identifying-missing.html">
     6.2. Identifying Missing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/handling-missing-data.html">
     6.3. Handling Missing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/single-valued-imputation.html">
     6.4. Single-Valued Imputation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/probabilistic-imputation.html">
     6.5. Probabilistic Imputation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 2: Collecting Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/introduction.html">
   7. Data Collection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/existing-data.html">
     7.1. Using Existing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/requests.html">
     7.2. HTTP Requests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/html.html">
     7.3. Parsing HTML
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/introduction.html">
   8. Information Extaction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/patterns.html">
     8.1. Text Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/nlp.html">
     8.2. Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/introduction.html">
   9. Introduction to Features
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/features.html">
     9.1. Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/data-pipelines.html">
     9.2. Data Pipelines
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 3: Modeling With Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/introduction.html">
   10. Modeling Basics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/intro-modeling.html">
     10.1. Introduction to Statistical Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/model-building.html">
     10.2. Building Modeling Pipelines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11/introduction.html">
   11. Bias and Variance
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/fitting-inference.html">
     11.1. Model Quality (Inference)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/fitting-prediction.html">
     11.2. Model Quality (Prediction)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/cross-validation.html">
     11.3. Cross Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/parameter-search.html">
     11.4. Parameter Search
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12/introduction.html">
   12. Evaluating Models; Fairness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/eval.html">
     12.1. Evaluation metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/parity.html">
     12.2. Parity Measures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/fairness.html">
     12.3. Fairness in Machine Learning
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/05/grouping.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/dsc-courses/ds-in-practice/master?urlpath=tree/book/content/05/grouping.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-questions-to-code">
   From questions to code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#group-wise-operations-split-apply-combine">
   Group-wise operations: split-apply-combine
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#split-the-groupby-dataframe-method">
     Split: the
     <code class="docutils literal notranslate">
      <span class="pre">
       groupby
      </span>
     </code>
     DataFrame method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-combine-groupby-methods">
     Apply-Combine:
     <code class="docutils literal notranslate">
      <span class="pre">
       GroupBy
      </span>
     </code>
     methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generic-apply-combine-apply-method">
     Generic Apply-Combine:
     <code class="docutils literal notranslate">
      <span class="pre">
       apply
      </span>
     </code>
     method
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data Granularity:</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-questions-to-code">
   From questions to code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#group-wise-operations-split-apply-combine">
   Group-wise operations: split-apply-combine
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#split-the-groupby-dataframe-method">
     Split: the
     <code class="docutils literal notranslate">
      <span class="pre">
       groupby
      </span>
     </code>
     DataFrame method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-combine-groupby-methods">
     Apply-Combine:
     <code class="docutils literal notranslate">
      <span class="pre">
       GroupBy
      </span>
     </code>
     methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generic-apply-combine-apply-method">
     Generic Apply-Combine:
     <code class="docutils literal notranslate">
      <span class="pre">
       apply
      </span>
     </code>
     method
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="data-granularity">
<h1>Data Granularity:<a class="headerlink" href="#data-granularity" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="from-questions-to-code">
<h2>From questions to code<a class="headerlink" href="#from-questions-to-code" title="Permalink to this headline">¶</a></h2>
<p>While determining what measurements to make to understand a process is clearly important, the difficulty of understanding <em>what</em> or <em>who</em> to measure shouldn’t be overlooked. One needs to be clear about both the individuals being observed, along with the attributes being measured.</p>
<p><strong>Example:</strong> Suppose a Data Scientist, working at video streaming platform, studies users’ viewing behavior. The data she uses might come in two possible forms:</p>
<ol class="simple">
<li><p>Each row represents an event comprising of a user streaming a particular video; attributes include the user streaming the video, the name of the video, the length of the streaming event, whether the video was watched to completion, etc.</p></li>
<li><p>Each row represents a user; attributes include the average and total time spent streaming, how often a video was watched to completion, etc.</p></li>
</ol>
<p>These datasets have different <em>data designs</em>; each is better suited to answer certain questions than the other. However, the user-level data is fundamentally an aggregate view of the event-level data: it gives a <em>coarser</em> view of the data. Below are a few differences between the two data designs.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>—</p></th>
<th class="head"><p>Event Level (fine)</p></th>
<th class="head"><p>User Level (coarse)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Answering questions about:</p></td>
<td><p>cost of running servers</p></td>
<td><p>net revenue per user</p></td>
</tr>
<tr class="row-odd"><td><p>Cost implications of data collection:</p></td>
<td><p>large/expensive to store</p></td>
<td><p>smaller/cheaper to store</p></td>
</tr>
<tr class="row-even"><td><p>Privacy implications of data collection:</p></td>
<td><p>possibly detailed personal data</p></td>
<td><p>more easily anonymized</p></td>
</tr>
<tr class="row-odd"><td><p>Flexibility of use:</p></td>
<td><p>usable for a broad range of questions</p></td>
<td><p>drops more information about underlying events</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>Suppose, for example, the Data Scientist notices when looking at the user-level data that 5% of paying users accounts for 95% of all video watched on the platform. A knee-jerk response might be to discourage these users from such heavy use, as this small number of paying subscribers account for most of the costs of running the platform. However, a look at the event-level data might reveal that these users all have something in common: they watch the new live-streaming channels that the company is promoting, which consists of inordinately long events. In fact, the root of the problem lies in the service being promoted, not the users.</p>
<p>Data can be represented at different levels of granularity and it’s useful to move from a fine grained picture to coarser summaries while understanding what information is lost. An astute Data Scientist treats coarse grained data with skepticism, without losing the ability to effectively use it.</p>
</div>
<div class="section" id="group-wise-operations-split-apply-combine">
<h2>Group-wise operations: split-apply-combine<a class="headerlink" href="#group-wise-operations-split-apply-combine" title="Permalink to this headline">¶</a></h2>
<p>Moving to coarser views of a dataset involves <em>grouping individuals into subpopulations</em> and aggregating the measurements of the subpopulation into a table containing the aggregate summaries. This process follows the logic of <a class="reference external" href="https://www.jstatsoft.org/article/view/v040i01/v40i01.pdf">split-apply-combine</a> nicely summarized in the context of data analysis by Hadley Wickham. This data processing strategy is useful across a very broad class of computational task, allowing one to:</p>
<ul class="simple">
<li><p>cleanly describe processing logic into easy-to-understand, discrete steps, and</p></li>
<li><p>scale a solution, using parallel processing, to large datasets.</p></li>
</ul>
<p>The components of split-apply-combine are as follows:</p>
<ol class="simple">
<li><p><strong>Split</strong> the data into groups based on some criteria (often encoded in a column).</p></li>
<li><p><strong>Apply</strong> function(s) to each group independently.</p></li>
<li><p><strong>Combine</strong> the results into a data structure (e.g. a Series or DataFrame)</p></li>
</ol>
<p>For example, given a table with group labels A, B, C in a column <code class="docutils literal notranslate"><span class="pre">Col1</span></code>, the sum of values in each group is calculated by splitting the table in a table for each group, summing the values in each groups’ table separately, and combining the resulting sums in a new, smaller, table (see the figure below).</p>
<p><img alt="split-apply-combine" src="../../_images/split-apply-combine.png" /></p>
<p>This abstraction allows one to develop transformations on a single table without worrying about the particulars of how it’s applied across groups and returned as an aggregated result.</p>
<div class="section" id="split-the-groupby-dataframe-method">
<h3>Split: the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> DataFrame method<a class="headerlink" href="#split-the-groupby-dataframe-method" title="Permalink to this headline">¶</a></h3>
<p>In the context of Pandas DataFrames, the split-apply-combine paradigm is implemented via the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">DataFrameGroupBy</a> class.</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame.groupby(key)</span></code> is a DataFrame method that represents the “split” portion of split-apply-combine. The <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object it returns is a dictionary like object, keyed on a (list of) column name(s) <code class="docutils literal notranslate"><span class="pre">key</span></code>, with values given by the indices of each group.</p>
<p><strong>Example:</strong> <code class="docutils literal notranslate"><span class="pre">df</span></code> defined below is a DataFrame with group labels contained in <code class="docutils literal notranslate"><span class="pre">Col1</span></code> and integer values in <code class="docutils literal notranslate"><span class="pre">Col2</span></code> and <code class="docutils literal notranslate"><span class="pre">Col3</span></code>. Several useful <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> properties and methods are illustrated below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Col1&#39;</span><span class="p">:</span> <span class="s1">&#39;A B C C B B A&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> 
    <span class="s1">&#39;Col2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s1">&#39;Col3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col1</th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object does not have a descriptive string representation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Col1&#39;</span><span class="p">)</span>
<span class="n">G</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x11ff2ae80&gt;
</pre></div>
</div>
</div>
</div>
<p>However, the <code class="docutils literal notranslate"><span class="pre">groups</span></code> property returns a dictionary keyed by group label, with the indices of <code class="docutils literal notranslate"><span class="pre">df</span></code> corresponding to each group label:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">groups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;A&#39;: Int64Index([0, 6], dtype=&#39;int64&#39;),
 &#39;B&#39;: Int64Index([1, 4, 5], dtype=&#39;int64&#39;),
 &#39;C&#39;: Int64Index([2, 3], dtype=&#39;int64&#39;)}
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">G.get_group(label)</span></code> method returns the DataFrame <code class="docutils literal notranslate"><span class="pre">df.loc[df[key]</span> <span class="pre">==</span> <span class="pre">label]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col1</th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If the aggregation only involves one of the columns, selecting that column saves space. The resulting object is a <code class="docutils literal notranslate"><span class="pre">SeriesGroupBy</span></code> object, which is similar to a <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="p">[</span><span class="s1">&#39;Col2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x11a64df28&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="p">[</span><span class="s1">&#39;Col2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1
6    3
Name: Col2, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>Example:</strong> In place of a column name, <code class="docutils literal notranslate"><span class="pre">groupby</span></code> also accepts a function to split data into groups:</p>
<ul class="simple">
<li><p>the domain of the function is the index of the DataFrame,</p></li>
<li><p>the groups are labeled by the image of the function,</p></li>
<li><p>each group consists of indices that map to the same value under the function.</p></li>
</ul>
<p>For example, the following function creates a <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object with three groups: Small, Medium, and Large.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grouper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Small&#39;</span>
    <span class="k">elif</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Medium&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Large&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">df</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Col2&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groups</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Large&#39;: Int64Index([3, 5, 3], dtype=&#39;int64&#39;, name=&#39;Col2&#39;),
 &#39;Medium&#39;: Int64Index([4], dtype=&#39;int64&#39;, name=&#39;Col2&#39;),
 &#39;Small&#39;: Int64Index([1, 2, 2], dtype=&#39;int64&#39;, name=&#39;Col2&#39;)}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="apply-combine-groupby-methods">
<h3>Apply-Combine: <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> methods<a class="headerlink" href="#apply-combine-groupby-methods" title="Permalink to this headline">¶</a></h3>
<p>Recall that the ‘apply-combine’ steps consist of applying a transformation to the groups created in the ‘split’ step, followed by combining the separate results into a single data structure. Pandas <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> methods couple these two steps: while each method implements its own apply logic, all of them combine the transformed groups into a natural output data structure.</p>
<p>Many DataFrame methods also naturally extend to <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> objects. The Pandas <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html">documentation</a> contains an exhaustive list.</p>
<p><strong>Example:</strong> Calculating the mean of the groups of the of the simple DataFrame <code class="docutils literal notranslate"><span class="pre">df</span></code> defined in the previous example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col1</th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Col1&#39;</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
    <tr>
      <th>Col1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>2.0</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>C</th>
      <td>3.5</td>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Example:</strong> The table <code class="docutils literal notranslate"><span class="pre">climbs</span></code> contains a list of almost 4000 attempts at climbing to the summit of Mt. Rainier in Washington State, during the years 2014-2015. Each row represents a party of climbers attempting to climbing a specified <em>route</em> up the mountain, on a given <em>date</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climbs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Route</th>
      <th>Attempted</th>
      <th>Succeeded</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11/27/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11/21/2015</td>
      <td>Disappointment Cleaver</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10/15/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3966</th>
      <td>1/6/2014</td>
      <td>Disappointment Cleaver</td>
      <td>8</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3967</th>
      <td>1/5/2014</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3968</th>
      <td>1/4/2014</td>
      <td>Gibraltar Ledges</td>
      <td>3</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>3969 rows × 4 columns</p>
</div></div></div>
</div>
<p>Most parties are composed of multiple climbers, as evidenced by the ‘Attempted’ column. The total number of people who attempted each route over the two year period is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climbs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">)[</span><span class="s1">&#39;Attempted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Route
Curtis Ridge                  4
Disappointment Cleaver    15227
Edmonds HW                    4
                          ...  
Tahoma Cleaver                3
Tahoma Glacier               33
Wilson Headwall               5
Name: Attempted, Length: 23, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Notice the resulting Series is sorted by the grouping <em>key</em>; there are 24 routes sorted alphabetically.</p>
<p>To calculate the routes with the most climbers on a given day, group the climbs by both date and route name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">climbs</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Route&#39;</span><span class="p">])[</span><span class="s1">&#39;Attempted&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Route</th>
      <th>Attempted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7/25/2014</td>
      <td>Disappointment Cleaver</td>
      <td>182</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6/26/2015</td>
      <td>Disappointment Cleaver</td>
      <td>144</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7/3/2015</td>
      <td>Disappointment Cleaver</td>
      <td>135</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>943</th>
      <td>5/28/2015</td>
      <td>Kautz Glacier</td>
      <td>1</td>
    </tr>
    <tr>
      <th>944</th>
      <td>6/13/2015</td>
      <td>Kautz Glacier</td>
      <td>1</td>
    </tr>
    <tr>
      <th>945</th>
      <td>8/8/2015</td>
      <td>Emmons-Winthrop</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>946 rows × 3 columns</p>
</div></div></div>
</div>
<p><em>Remark:</em> Grouping on multiple columns results in a multi-indexed Series/DataFrame; using <code class="docutils literal notranslate"><span class="pre">reset_index</span></code> on the output simplifies further processing.</p>
<p>Similarly to the case of DataFrames, the <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> method <strong><code class="docutils literal notranslate"><span class="pre">agg</span></code></strong> applies columnar Series methods to the groups of a <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object. Compare how each of the following outputs relates to the analogous DataFrame method.</p>
<ul class="simple">
<li><p>Passing a list of functions applies each function to each column of each group</p></li>
<li><p>Passing a dictionary of functions applies the functions to the specified column in each group.</p></li>
</ul>
<p><strong>Example:</strong> Using <code class="docutils literal notranslate"><span class="pre">agg</span></code> quickly creates a compact table of descriptive statistics of the attempts up the routes on Mt. Rainier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climbs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="5" halign="left">Attempted</th>
      <th colspan="5" halign="left">Succeeded</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
      <th>count</th>
      <th>sum</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
    </tr>
    <tr>
      <th>Route</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Curtis Ridge</th>
      <td>2</td>
      <td>4</td>
      <td>2.000000</td>
      <td>2.0</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Disappointment Cleaver</th>
      <td>2720</td>
      <td>15227</td>
      <td>5.598162</td>
      <td>4.0</td>
      <td>12</td>
      <td>2720</td>
      <td>8246</td>
      <td>3.031618</td>
      <td>2.0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>Edmonds HW</th>
      <td>2</td>
      <td>4</td>
      <td>2.000000</td>
      <td>2.0</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Tahoma Cleaver</th>
      <td>1</td>
      <td>3</td>
      <td>3.000000</td>
      <td>3.0</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>3.000000</td>
      <td>3.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Tahoma Glacier</th>
      <td>11</td>
      <td>33</td>
      <td>3.000000</td>
      <td>3.0</td>
      <td>5</td>
      <td>11</td>
      <td>11</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Wilson Headwall</th>
      <td>2</td>
      <td>5</td>
      <td>2.500000</td>
      <td>2.5</td>
      <td>3</td>
      <td>2</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>23 rows × 10 columns</p>
</div></div></div>
</div>
<p>The columns of the output are multi-indexed, as each function is applied to both the ‘Attempted’ and ‘Succeeded’ columns of the DataFrames of each route. For example, the DataFrame lists ‘Disappointment Cleaver’ was:</p>
<ul class="simple">
<li><p>attempted by 2720 climbing parties,</p></li>
<li><p>attempted by a total of 15227 climbers,</p></li>
<li><p>a total of 8246 climbers successfully made it to the summit by the route,</p></li>
<li><p>the average party size attempting the route was 5.59 climbers.</p></li>
</ul>
<p>Notice that the Date column was dropped from the output; Pandas drops non-numeric columns when any of the aggregation methods requires numeric data. Passing a dictionary of aggregations into <code class="docutils literal notranslate"><span class="pre">agg</span></code> allows for a more tailored set of aggregations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climbs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Attempted&#39;</span><span class="p">:[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Attempted</th>
      <th>Date</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>max</th>
      <th>max</th>
    </tr>
    <tr>
      <th>Route</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Curtis Ridge</th>
      <td>2.000000</td>
      <td>2</td>
      <td>6/12/2015</td>
    </tr>
    <tr>
      <th>Disappointment Cleaver</th>
      <td>5.598162</td>
      <td>12</td>
      <td>9/9/2015</td>
    </tr>
    <tr>
      <th>Edmonds HW</th>
      <td>2.000000</td>
      <td>2</td>
      <td>9/14/2014</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Tahoma Cleaver</th>
      <td>3.000000</td>
      <td>3</td>
      <td>6/5/2015</td>
    </tr>
    <tr>
      <th>Tahoma Glacier</th>
      <td>3.000000</td>
      <td>5</td>
      <td>8/2/2014</td>
    </tr>
    <tr>
      <th>Wilson Headwall</th>
      <td>2.500000</td>
      <td>3</td>
      <td>4/26/2015</td>
    </tr>
  </tbody>
</table>
<p>23 rows × 3 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="generic-apply-combine-apply-method">
<h3>Generic Apply-Combine:  <code class="docutils literal notranslate"><span class="pre">apply</span></code> method<a class="headerlink" href="#generic-apply-combine-apply-method" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">apply</span></code> method is the most general <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> method; it applies any function defined on the ‘grouped’ dataframes and attempts to combined the result into meaningful output. While very flexible, the <code class="docutils literal notranslate"><span class="pre">apply</span></code> method is slower, less space efficient, and more prone to error than using standard <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> methods; it should be avoided when possible.</p>
<p>Use this method when either:</p>
<ul class="simple">
<li><p>the transformation depends on complicated group-wise conditions on multiple columns.</p></li>
<li><p>the output dimensions of the resulting Series/DataFrame are nonstandard.</p></li>
</ul>
<p><strong>Example:</strong> For the dataframe <code class="docutils literal notranslate"><span class="pre">df</span></code>, generate a dataframe indexed by label <code class="docutils literal notranslate"><span class="pre">Col1</span></code>, with five of random integers chosen within the range of values of <code class="docutils literal notranslate"><span class="pre">Col2</span></code> within the group. For example, within the <code class="docutils literal notranslate"><span class="pre">A</span></code> group <code class="docutils literal notranslate"><span class="pre">Col2</span></code> contains 1, 3; the output row with index <code class="docutils literal notranslate"><span class="pre">A</span></code> should therefore contain five randomly chosen integers between 1 and 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col1</th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Define a function that takes in a group-dataframe (i.e. retrievable by <code class="docutils literal notranslate"><span class="pre">df.groupby('Col1').get_group(label)</span></code>), calculates the minimum and maximum values of Col2 within that group, and returns the random integers as a Series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_random</span><span class="p">(</span><span class="n">gp</span><span class="p">):</span>
    <span class="n">n_rand</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[</span><span class="s1">&#39;Col2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">gp</span><span class="p">[</span><span class="s1">&#39;Col2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_rand</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rand_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rand</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">apply</span></code> method combines these Series of random integers into a DataFrame indexed by label:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">generate_random</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rand_1</th>
      <th>rand_2</th>
      <th>rand_3</th>
      <th>rand_4</th>
      <th>rand_5</th>
    </tr>
    <tr>
      <th>Col1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>B</th>
      <td>2</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>C</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Another common use case for apply is when the output DataFrame has the same index as the input DataFrame. This often occurs when the elements of a table need to be scaled by a groupwise condition.</p>
<p><strong>Example (transform):</strong> Scale the DataFrame linearly, so that an entry is represented as the proportion of the range for each group. For example, in ‘Col3’, the ‘B’ group has values 3, 4, 5. The range of the ‘B’ group is (5 - 3) = 2. The value 4 is halfway is in the middle of the range and thus is scaled to 0.5.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col1</th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale_by_range</span><span class="p">(</span><span class="n">gp</span><span class="p">):</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gp</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">from_min</span> <span class="o">=</span> <span class="n">gp</span> <span class="o">-</span> <span class="n">gp</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">from_min</span> <span class="o">/</span> <span class="n">rng</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">scale_by_range</span></code> returns a DataFrames of the same index as the input. Pandas thus aligns them by common columns, returning a dataframe of the same shape as <code class="docutils literal notranslate"><span class="pre">df</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">scale_by_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Pandas provides a method specifically for this pattern:  <code class="docutils literal notranslate"><span class="pre">transform</span></code>. It’s appropriate when passing a function to <code class="docutils literal notranslate"><span class="pre">apply</span></code> that returns a Series/DataFrame with the same index as the input. This method is both faster and less error prone than using <code class="docutils literal notranslate"><span class="pre">apply</span></code> in this case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">scale_by_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col2</th>
      <th>Col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Example:</strong> Among the 24 routes up Mt. Rainier, only a few of them see more than 15 attempts in 2014-15. The <code class="docutils literal notranslate"><span class="pre">apply</span></code> method can be used to filter out all attempts on routes that aren’t very popular (fewer than 15 attempts in 2014-15). The split-apply-combine logic:</p>
<ol class="simple">
<li><p>splits the table into separate routes on the mountain (split),</p></li>
<li><p>checks the size of each table (apply):</p>
<ul class="simple">
<li><p>leaving the table untouched if it contains at least 15 rows,</p></li>
<li><p>otherwise, omitting the rows (returning an empty DataFrame)</p></li>
</ul>
</li>
<li><p>Aggregating the (possibly empty) DataFrames into a filtered subtable of the original <code class="docutils literal notranslate"><span class="pre">climbs</span></code>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_few</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;return df if it has at least `min_size` rows,</span>
<span class="sd">    otherwise return an empty dataframe with the same columns&#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_size</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popular_climbs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">climbs</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">filter_few</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># drop group key: Route</span>
<span class="p">)</span>

<span class="n">popular_climbs</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Route</th>
      <th>Attempted</th>
      <th>Succeeded</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11/27/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11/21/2015</td>
      <td>Disappointment Cleaver</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10/15/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3966</th>
      <td>1/6/2014</td>
      <td>Disappointment Cleaver</td>
      <td>8</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3967</th>
      <td>1/5/2014</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3968</th>
      <td>1/4/2014</td>
      <td>Gibraltar Ledges</td>
      <td>3</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>3914 rows × 4 columns</p>
</div></div></div>
</div>
<p>The resulting table is a filtered subtable of the original table. To verify all routes contained in <code class="docutils literal notranslate"><span class="pre">popular_climbs</span></code> have at least 15 attempts, we can calculate the distribution of routes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">popular_climbs</span><span class="p">[</span><span class="s1">&#39;Route&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Disappointment Cleaver    2720
Emmons-Winthrop            631
Kautz Glacier              181
                          ... 
Liberty Ridge               69
Ingraham Direct             53
Ptarmigan Ridge             22
Name: Route, Length: 9, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>Example:</strong> This pattern is common enough that Pandas provides the <code class="docutils literal notranslate"><span class="pre">filter</span></code> method to optimize this computation. The <code class="docutils literal notranslate"><span class="pre">filter</span></code> method takes in a boolean ‘filtering function’ as input. The <code class="docutils literal notranslate"><span class="pre">filter</span></code> method keeps a grouped DataFrame exactly when the filter function returns <code class="docutils literal notranslate"><span class="pre">True</span></code>. Repeating the prior example, to filter out all but the popular climbing routes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climbs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Route</th>
      <th>Attempted</th>
      <th>Succeeded</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11/27/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11/21/2015</td>
      <td>Disappointment Cleaver</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10/15/2015</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3966</th>
      <td>1/6/2014</td>
      <td>Disappointment Cleaver</td>
      <td>8</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3967</th>
      <td>1/5/2014</td>
      <td>Disappointment Cleaver</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3968</th>
      <td>1/4/2014</td>
      <td>Gibraltar Ledges</td>
      <td>3</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>3914 rows × 4 columns</p>
</div></div></div>
</div>
<p><em>Remark:</em> The same filtering is possible by a two step process that avoids a <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, via:</p>
<ol class="simple">
<li><p>use the empirical distribution of routes to create an array of ‘popular routes’</p></li>
<li><p>filter the original <code class="docutils literal notranslate"><span class="pre">climbs</span></code> DataFrame using a boolean array created with the <code class="docutils literal notranslate"><span class="pre">isin</span></code> DataFrame method.</p></li>
</ol>
<p>Try this! Of course, calculating an empirical categorical distribution on a Series, using <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code>, is logically equivalent to splitting by Route and taking the size of each group; this approach is more memory efficient, though slower.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/05"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="introduction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Aggregation and Extension of Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="understanding-aggregations.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Understanding Aggregations</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Aaron Fraenkel<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>