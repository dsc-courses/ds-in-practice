
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Combining Data: Attributes &#8212; Data Science in Practice</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Permutation Tests" href="permutation-tests.html" />
    <link rel="prev" title="Combining Data: Observations" href="appending-data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/toolbox.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science in Practice</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Data Science in Practice
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 1: Understanding Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/introduction.html">
   1. Introduction to Data Science
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/what-is-data-science.html">
     1.1. What is Data Science?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/scientific-method.html">
     1.2. The Scientific Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/data-science-example.html">
     1.3. A Data Science Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/introduction.html">
   2. Tabular Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/tabular-data.html">
     2.1. Introduction to Tabular Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/methods.html">
     2.2. DataFrame Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data-types.html">
     2.3. Data Types and Performance
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/introduction.html">
   3. Querying and Describing Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/selecting-data.html">
     3.1. Selecting Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/kinds-of-data.html">
     3.2. Kinds of Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/categorical-distributions.html">
     3.3. Categorical Distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/quantitative-distributions.html">
     3.4. Quantitative Distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/introduction.html">
   4. Understanding Assumptions and Data Cleaning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modifying-dataframes.html">
     4.1. Modifying DataFrames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cleaning.html">
     4.2. Cleaning Messy Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/eda.html">
     4.3. Exploratory Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/asking-questions.html">
     4.4. Hypothesis Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="introduction.html">
   5. Aggregation and Extension of Data
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="grouping.html">
     5.1. Data Granularity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="understanding-aggregations.html">
     5.2. Understanding Aggregations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="appending-data.html">
     5.3. Combining Data (Observations)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.4. Combining Data (Attributes)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="permutation-tests.html">
     5.5. Permutation Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="eda-2.html">
     5.6. Exploratory Data Analysis II
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/introduction.html">
   6. Missing Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/defining-missing.html">
     6.1. Definitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/identifying-missing.html">
     6.2. Identifying Missing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/handling-missing-data.html">
     6.3. Handling Missing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/single-valued-imputation.html">
     6.4. Single-Valued Imputation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/probabilistic-imputation.html">
     6.5. Probabilistic Imputation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 2: Collecting Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/introduction.html">
   7. Data Collection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/existing-data.html">
     7.1. Using Existing Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/requests.html">
     7.2. HTTP Requests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/html.html">
     7.3. Parsing HTML
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/introduction.html">
   8. Information Extaction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/patterns.html">
     8.1. Text Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/nlp.html">
     8.2. Natural Language Processing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/introduction.html">
   9. Introduction to Features
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/features.html">
     9.1. Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/data-pipelines.html">
     9.2. Data Pipelines
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 3: Modeling With Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/introduction.html">
   10. Modeling Basics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/intro-modeling.html">
     10.1. Introduction to Statistical Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/model-building.html">
     10.2. Building Modeling Pipelines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11/introduction.html">
   11. Bias and Variance
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/fitting-inference.html">
     11.1. Model Quality (Inference)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/fitting-prediction.html">
     11.2. Model Quality (Prediction)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/cross-validation.html">
     11.3. Cross Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/parameter-search.html">
     11.4. Parameter Search
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12/introduction.html">
   12. Evaluating Models; Fairness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/eval.html">
     12.1. Evaluation metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/parity.html">
     12.2. Parity Measures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/fairness.html">
     12.3. Fairness in Machine Learning
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/05/joining-data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/dsc-courses/ds-in-practice/master?urlpath=tree/book/content/05/joining-data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-different-measurements-over-the-same-individuals">
   Combining different measurements over the same individuals
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joining-data-column-wise">
     Joining data column-wise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#join-types">
     Join types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#many-to-one-joins">
     Many-to-one joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#many-to-many-joins">
     Many-to-many joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#broadcast-join">
     Broadcast join
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#approximate-join">
     Approximate join
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Combining Data: Attributes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-different-measurements-over-the-same-individuals">
   Combining different measurements over the same individuals
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joining-data-column-wise">
     Joining data column-wise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#join-types">
     Join types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#many-to-one-joins">
     Many-to-one joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#many-to-many-joins">
     Many-to-many joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#broadcast-join">
     Broadcast join
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#approximate-join">
     Approximate join
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="combining-data-attributes">
<h1>Combining Data: Attributes<a class="headerlink" href="#combining-data-attributes" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="combining-different-measurements-over-the-same-individuals">
<h2>Combining different measurements over the same individuals<a class="headerlink" href="#combining-different-measurements-over-the-same-individuals" title="Permalink to this headline">¶</a></h2>
<p>Adding additional attributes to an existing dataset is often necessary to improve the description of the data generating process and answer the questions being asked of the data. In its most simple form, such a task consists of tables of the same individuals, with different attributes, collected for different purposes.</p>
<p>Such a process simply needs to add the columns of the second table to the first table. However, this process only works when the rows of the two tables correspond to the same individuals. Assuming a one-to-one correspondence between the individuals in the two tables, identified by their index, combining the columns of the two tables requires two steps:</p>
<ul class="simple">
<li><p>sorting each table by their respective indexes (i.e. lining them up),</p></li>
<li><p>iterating through the (common) index of each table, combining the attributes of each row into a new table.</p></li>
</ul>
<p><em>Remark 1:</em> This procedure is implicitly done by Pandas whenever setting a Series as a new column of an existing DataFrame.</p>
<p><em>Remark 2:</em> Understanding the internals of this procedure is important for both being able to debug performance issues, as well as implement custom procedures when the correspondence between the rows of the tables is not obvious.</p>
<p>This procedure is known as <strong>joining</strong> or <strong>merging</strong> tables (column-wise). The correspondence between the rows (e.g. via a shared index) is called a <strong>join key</strong>.</p>
<p><strong>Example:</strong> Below, two tables contain characteristics of California counties obtained from the <a class="reference external" href="http://factfinder2.census.gov/">US Census</a>: one contains a population attribute, the other contains the median household income. The join key is the ‘County’ column.</p>
<img src="imgs/join_simple.png"/><div class="section" id="joining-data-column-wise">
<h3>Joining data column-wise<a class="headerlink" href="#joining-data-column-wise" title="Permalink to this headline">¶</a></h3>
<p>Pandas has multiple ways of executing a (column-wise) join of DataFrames. Below outlines each and their relative advantages. In spite of the options, one should use the <code class="docutils literal notranslate"><span class="pre">merge</span></code> method whenever possible!</p>
<p><strong>Join Technique 1: column(s) assignment</strong> The most simple way of joining the columns of two tables along a shared index is by column(s) assignment. If <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code> have indexes in one-to-one correspondence, they can be joined via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span>
</pre></div>
</div>
<p>This technique is simple and space efficient, since column assignment modifies the left-hand DataFrame in-place. However it has many disadvantages:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Advantages</p></th>
<th class="head"><p>Disadvantages</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Space Efficient</p></td>
<td><p>Doesn’t work with the method chaining</p></td>
</tr>
<tr class="row-odd"><td><p>—</p></td>
<td><p>Joining more than two DataFrames requires multiple lines</p></td>
</tr>
<tr class="row-even"><td><p>—</p></td>
<td><p>Works only when indexes are in one-to-one correspondence</p></td>
</tr>
<tr class="row-odd"><td><p>—</p></td>
<td><p>Sorts the two DataFrames by index, even if already aligned</p></td>
</tr>
</tbody>
</table>
<p><strong>Join Technique 2 (<code class="docutils literal notranslate"><span class="pre">concat</span></code>):</strong> The Pandas function <code class="docutils literal notranslate"><span class="pre">concat</span></code> column-wise joins a list of DataFrames by a shared index, with several convenient keyword arguments. If <code class="docutils literal notranslate"><span class="pre">df1,...,dfN</span></code> are DataFrames, then the columns of these DataFrames can be joined by passing them to <code class="docutils literal notranslate"><span class="pre">concat</span></code> in a list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">dfN</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>This function has many advantages over column assignment:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Advantages</p></th>
<th class="head"><p>Disadvantages</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Can easily join many DataFrames</p></td>
<td><p>Doesn’t work with method chaining</p></td>
</tr>
<tr class="row-odd"><td><p>Indexes don’t need to be 1-1 correspondence</p></td>
<td><p>The DataFrames must of a common index</p></td>
</tr>
<tr class="row-even"><td><p>Can skip sorting indexes by setting <code class="docutils literal notranslate"><span class="pre">ignore_index=True</span></code></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p><strong>Join Technique 3 (<code class="docutils literal notranslate"><span class="pre">merge</span></code>):</strong> The <code class="docutils literal notranslate"><span class="pre">merge</span></code> method is the most flexible joining technique in Pandas. By default, it joins the columns of two DataFrames on common columns. If <code class="docutils literal notranslate"><span class="pre">df1,...,dfN</span></code> are DataFrames with shared columns that identify observations between them, the DataFrames can be joined by chaining together successive <code class="docutils literal notranslate"><span class="pre">merge</span></code> calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="o">...</span><span class="n">merge</span><span class="p">(</span><span class="n">dfN</span><span class="p">)</span>
</pre></div>
</div>
<p>If the DataFrames have a shared index, then <code class="docutils literal notranslate"><span class="pre">merge</span></code> is called with the <code class="docutils literal notranslate"><span class="pre">left_index/right_index=True</span></code> keyword argument.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Advantages</p></th>
<th class="head"><p>Disadvantages</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Works with method chaining</p></td>
<td><p>Can’t pass an arbitrary list of DataFrames</p></td>
</tr>
<tr class="row-odd"><td><p>Join key doesn’t need to be in index</p></td>
<td><p>Can’t skip sorting by the join key</p></td>
</tr>
<tr class="row-even"><td><p>Rows don’t need to be 1-1 correspondence</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counties</span> <span class="o">=</span> <span class="n">pop_counties</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">inc_counties</span><span class="p">)</span>
<span class="n">counties</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County</th>
      <th>Population</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Calaveras</td>
      <td>44921</td>
      <td>54936</td>
    </tr>
    <tr>
      <th>1</th>
      <td>San Diego</td>
      <td>3183143</td>
      <td>63996</td>
    </tr>
    <tr>
      <th>2</th>
      <td>San Joaquin</td>
      <td>701050</td>
      <td>53253</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Marin</td>
      <td>256802</td>
      <td>91529</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Monterey</td>
      <td>424927</td>
      <td>58582</td>
    </tr>
    <tr>
      <th>57</th>
      <td>San Mateo</td>
      <td>739837</td>
      <td>91421</td>
    </tr>
  </tbody>
</table>
<p>58 rows × 3 columns</p>
</div></div></div>
</div>
<p>Check the relative sizes of the inputs confirm every row has its expected match. The input tables exactly one entry for each of the 58 California counties; the joined table should have one row per county and three columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pop_counties</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">inc_counties</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">counties</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(58, 2)
(58, 2)
(58, 3)
</pre></div>
</div>
</div>
</div>
<p><em>Remark:</em> this simple check can save hours of debugging!</p>
</div>
<div class="section" id="join-types">
<h3>Join types<a class="headerlink" href="#join-types" title="Permalink to this headline">¶</a></h3>
<p>Not uncommonly, when joining two tables, the observations don’t perfectly align. In these cases, care must be taken with the approach to joining the observations. There are three possibilities:</p>
<ol class="simple">
<li><p>the observations are in one-to-one correspondence,</p></li>
<li><p>one of the tables contains observations not contained in the other,</p></li>
<li><p>both of the tables contain observations missing in the other.</p></li>
</ol>
<p>In the first case, there is no ambiguity in combining the two tables. However, in the latter two cases, one has to decide whether to retain the observations that are present in only one of the tables. These cases are enumerated in the following <em>join types</em>.</p>
<p>Given two tables, the possible join types of a combined table are:</p>
<ul class="simple">
<li><p>An <strong>inner join</strong> keeps <em>only</em> the observations with a matched join key,</p></li>
<li><p>An <strong>outer join</strong> keeps all observations, even if not-matched,</p></li>
<li><p>A <strong>left join</strong> keeps all observations in the left table,</p></li>
<li><p>A <strong>right join</strong> keeps all observations in the right table.</p></li>
</ul>
<p>Below, the join types are illustrated with Venn diagrams; the diagrams overlap if the tables share an observation:
<img alt="join types" src="../../_images/join_type.png" /></p>
<p>The default operation is typical as inner join, as is true for the <code class="docutils literal notranslate"><span class="pre">merge</span></code> method.</p>
<p><strong>Example:</strong> Suppose the county population table only includes information on counties with populations over 1.5M residents. The inner-join between this partial population table and the full income table will drop income information!</p>
<p>The partial population file only contains seven of the 58 counties:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_pop</span> <span class="o">=</span> <span class="n">pop_counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pop_counties</span><span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">]</span>
<span class="n">partial_pop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County</th>
      <th>Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>San Diego</td>
      <td>3183143</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Riverside</td>
      <td>2266899</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Santa Clara</td>
      <td>1841569</td>
    </tr>
    <tr>
      <th>24</th>
      <td>San Bernardino</td>
      <td>2078586</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Los Angeles</td>
      <td>9974203</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Alameda</td>
      <td>1559308</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Orange</td>
      <td>3086331</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The inner-join only contains the seven large population counties, even though the income table contains all 58 counties:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_pop</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">inc_counties</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County</th>
      <th>Population</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>San Diego</td>
      <td>3183143</td>
      <td>63996</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Riverside</td>
      <td>2266899</td>
      <td>56592</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Santa Clara</td>
      <td>1841569</td>
      <td>93854</td>
    </tr>
    <tr>
      <th>3</th>
      <td>San Bernardino</td>
      <td>2078586</td>
      <td>54100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Los Angeles</td>
      <td>9974203</td>
      <td>55870</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Alameda</td>
      <td>1559308</td>
      <td>73775</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Orange</td>
      <td>3086331</td>
      <td>75998</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>A right-join retains all the income values and adds population entries when available; a <code class="docutils literal notranslate"><span class="pre">NaN</span></code> value appears when a corresponding county doesn’t appear in the population table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_pop</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">inc_counties</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>County</th>
      <th>Population</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>San Diego</td>
      <td>3183143.0</td>
      <td>63996</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Riverside</td>
      <td>2266899.0</td>
      <td>56592</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Santa Clara</td>
      <td>1841569.0</td>
      <td>93854</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55</th>
      <td>San Benito</td>
      <td>NaN</td>
      <td>67874</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Yolo</td>
      <td>NaN</td>
      <td>55508</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Lassen</td>
      <td>NaN</td>
      <td>53351</td>
    </tr>
  </tbody>
</table>
<p>58 rows × 3 columns</p>
</div></div></div>
</div>
<p><strong>Example:</strong> Joins in Pandas are <em>exact</em> matches between join keys, including a match on the data type. For example, columns with integer columns, with one of them typed as a string, will fail to properly join. These mistakes are hard to spot, as Pandas hides the type of the contents of DataFrames on formating.</p>
<p>Defining two dataframes with matching indexes of different types:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">df_strs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;0 1 2&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Joining the two DataFrames with an outer-join illustrates the failure to join on index:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">df_ints</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_strs</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">merged</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The index of the merged table contains distinct values of both integer and string type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([0, 1, 2, &#39;0&#39;, &#39;1&#39;, &#39;2&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p><strong>Example:</strong> By default, <code class="docutils literal notranslate"><span class="pre">merge</span></code> sets the join-key to the set of all common columns between the DataFrames being merged, sometimes leading to unintended consequences when both tables share similar attributes. The join-key can be specified explicitly using the keyword <code class="docutils literal notranslate"><span class="pre">on</span></code>.</p>
<p>The DataFrames <code class="docutils literal notranslate"><span class="pre">df1</span></code> and <code class="docutils literal notranslate"><span class="pre">df2</span></code> have different resulting joins when the join key is column ‘A’ vs. columns (‘A’, ‘B’):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_1&#39;</span><span class="p">,</span><span class="s1">&#39;_2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B_1</th>
      <th>B_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>4</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><em>Remark:</em> The <code class="docutils literal notranslate"><span class="pre">suffixes</span></code> argument decorates the duplicate column names with which table the column originated from.</p>
<p><strong>Example:</strong> When joining new attributes to a dataset under investigation, the additional information isn’t always available for the complete population. For example, when investigating the incomes by California county, suppose one attempts to join demographic information (such as population size) to the incomes dataset. However, if this demographic information is only available for counties with a large population, the merge dataset will exhibit significant bias:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">large_pop</span> <span class="o">=</span> <span class="n">pop_counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pop_counties</span><span class="p">[</span><span class="s1">&#39;Population&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200000</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Upon merging the incomes with the demographics, an <em>inner-join</em> drops all counties of small size. The resulting average income is quite different than the average income across all counties:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inc_counties</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">large_pop</span><span class="p">)[</span><span class="s1">&#39;Income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>63668.57142857143
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inc_counties</span><span class="p">[</span><span class="s1">&#39;Income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>56034.362068965514
</pre></div>
</div>
</div>
</div>
<p>By using an left-join, on can avoid dropping these observations (at the expense of introducing missing values into the merged dataset):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inc_counties</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">large_pop</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)[</span><span class="s1">&#39;Income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>56034.362068965514
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="many-to-one-joins">
<h3>Many-to-one joins<a class="headerlink" href="#many-to-one-joins" title="Permalink to this headline">¶</a></h3>
<p>A join performed on a join-key with duplicate entries results in either a ‘many-to-one’ or a ‘many-to-many’ join. Though these joins occur naturally, the resulting datasets might initially seem unintuitive.</p>
<p>Many-to-one joins occur naturally when using ‘lookup tables’ to attach richer information about an <em>attribute</em> of a dataset (as opposed to an individual). For example, a table might include the purchase history of customers subscribing to a music-streaming service:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Customer</p></th>
<th class="head"><p>Plan Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>23523</p></td>
<td><p>Premium</p></td>
</tr>
<tr class="row-odd"><td><p>43453</p></td>
<td><p>Premium</p></td>
</tr>
<tr class="row-even"><td><p>34523</p></td>
<td><p>Student</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>98345</p></td>
<td><p>Family</p></td>
</tr>
<tr class="row-odd"><td><p>13423</p></td>
<td><p>Premium</p></td>
</tr>
<tr class="row-even"><td><p>34234</p></td>
<td><p>Student</p></td>
</tr>
</tbody>
</table>
<p>Computing the total revenue generated from these purchases, one needs to merge this table with the three-row table of plan types:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Plan Type</p></th>
<th class="head"><p>Price</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Student</p></td>
<td><p>$4.99</p></td>
</tr>
<tr class="row-odd"><td><p>Premium</p></td>
<td><p>$9.99</p></td>
</tr>
<tr class="row-even"><td><p>Family</p></td>
<td><p>$14.99</p></td>
</tr>
</tbody>
</table>
<p>A few observations on how this join differs from the simple joins covered before:</p>
<ul class="simple">
<li><p>the join-key ‘Plan Type’ is an attribute of the table, not an identifier for the observations of the tables.</p></li>
<li><p>one expects the resulting joined table to contain the price next to each customer purchase; the each row in the small table is repeated many times over.</p></li>
</ul>
<p>The result of joining these two tables is:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Customer</p></th>
<th class="head"><p>Plan Type</p></th>
<th class="head"><p>Price</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>23523</p></td>
<td><p>Premium</p></td>
<td><p>$9.99</p></td>
</tr>
<tr class="row-odd"><td><p>43453</p></td>
<td><p>Premium</p></td>
<td><p>$9.99</p></td>
</tr>
<tr class="row-even"><td><p>34523</p></td>
<td><p>Student</p></td>
<td><p>$4.99</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>98345</p></td>
<td><p>Family</p></td>
<td><p>$14.99</p></td>
</tr>
<tr class="row-odd"><td><p>13423</p></td>
<td><p>Premium</p></td>
<td><p>$9.99</p></td>
</tr>
<tr class="row-even"><td><p>34234</p></td>
<td><p>Student</p></td>
<td><p>$4.99</p></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong> The dataset <code class="docutils literal notranslate"><span class="pre">cities</span></code> contains population and income information on 1442 California cities, along with the name of the county to which each city belongs. Using this dataset, one can roughly calculate which cities make significantly more or less than their neighbors: create a derived attribute using the ratio of the average household income of a given city to the average household income of the county in which it lies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>County</th>
      <th>Population</th>
      <th>Income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Acalanes Ridge</td>
      <td>Contra Costa</td>
      <td>1226</td>
      <td>160000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Acampo</td>
      <td>San Joaquin</td>
      <td>776</td>
      <td>141250.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Acton</td>
      <td>Los Angeles</td>
      <td>6956</td>
      <td>92245.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1439</th>
      <td>Yucaipa</td>
      <td>San Bernardino</td>
      <td>52406</td>
      <td>58506.0</td>
    </tr>
    <tr>
      <th>1440</th>
      <td>Yucca Valley</td>
      <td>San Bernardino</td>
      <td>21083</td>
      <td>43086.0</td>
    </tr>
    <tr>
      <th>1441</th>
      <td>Zayante</td>
      <td>Santa Cruz</td>
      <td>853</td>
      <td>81308.0</td>
    </tr>
  </tbody>
</table>
<p>1442 rows × 4 columns</p>
</div></div></div>
</div>
<p>Calculating this attribute requires joining the <code class="docutils literal notranslate"><span class="pre">county</span></code> dataset with the <code class="docutils literal notranslate"><span class="pre">city</span></code> dataset on the ‘County’ attribute. Since possibly many cities belong to the same county, this is a many-to-one join.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_with_county_info</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">counties</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;County&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_city&#39;</span><span class="p">,</span> <span class="s1">&#39;_county&#39;</span><span class="p">])</span>
<span class="n">cities_with_county_info</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>County</th>
      <th>Population_city</th>
      <th>Income_city</th>
      <th>Population_county</th>
      <th>Income_county</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Acalanes Ridge</td>
      <td>Contra Costa</td>
      <td>1226</td>
      <td>160000.0</td>
      <td>1081232</td>
      <td>79799</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alamo</td>
      <td>Contra Costa</td>
      <td>15639</td>
      <td>163151.0</td>
      <td>1081232</td>
      <td>79799</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alhambra Valley</td>
      <td>Contra Costa</td>
      <td>499</td>
      <td>62000.0</td>
      <td>1081232</td>
      <td>79799</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1435</th>
      <td>San Juan Bautista</td>
      <td>San Benito</td>
      <td>2219</td>
      <td>57717.0</td>
      <td>56888</td>
      <td>67874</td>
    </tr>
    <tr>
      <th>1436</th>
      <td>Tres Pinos</td>
      <td>San Benito</td>
      <td>457</td>
      <td>75893.0</td>
      <td>56888</td>
      <td>67874</td>
    </tr>
    <tr>
      <th>1437</th>
      <td>San Francisco</td>
      <td>San Francisco</td>
      <td>829072</td>
      <td>78378.0</td>
      <td>829072</td>
      <td>78378</td>
    </tr>
  </tbody>
</table>
<p>1438 rows × 6 columns</p>
</div></div></div>
</div>
<p><em>Remark:</em> What happens if the join key were not specified in the merge? What condition must be met for a city to belong to the merged table?</p>
<p>Once merged, the ‘income ratio’ attribute is simply the ratio of two columns. The cities with the highest income ratios are small gated communities within Los Angeles County:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">cities_with_county_info</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">income_ratio</span><span class="o">=</span><span class="n">cities_with_county_info</span><span class="p">[</span><span class="s1">&#39;Income_city&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cities_with_county_info</span><span class="p">[</span><span class="s1">&#39;Income_county&#39;</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;income_ratio&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>County</th>
      <th>Population_city</th>
      <th>Income_city</th>
      <th>Population_county</th>
      <th>Income_county</th>
      <th>income_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>134</th>
      <td>Hidden Hills</td>
      <td>Los Angeles</td>
      <td>1749</td>
      <td>245694.0</td>
      <td>9974203</td>
      <td>55870</td>
      <td>4.397602</td>
    </tr>
    <tr>
      <th>177</th>
      <td>Rolling Hills</td>
      <td>Los Angeles</td>
      <td>1689</td>
      <td>218583.0</td>
      <td>9974203</td>
      <td>55870</td>
      <td>3.912350</td>
    </tr>
    <tr>
      <th>169</th>
      <td>Palos Verdes Estates</td>
      <td>Los Angeles</td>
      <td>13568</td>
      <td>171328.0</td>
      <td>9974203</td>
      <td>55870</td>
      <td>3.066547</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>595</th>
      <td>Boulevard</td>
      <td>San Diego</td>
      <td>434</td>
      <td>12421.0</td>
      <td>3183143</td>
      <td>63996</td>
      <td>0.194090</td>
    </tr>
    <tr>
      <th>1301</th>
      <td>Valley Ford</td>
      <td>Sonoma</td>
      <td>167</td>
      <td>9312.0</td>
      <td>491790</td>
      <td>63799</td>
      <td>0.145958</td>
    </tr>
    <tr>
      <th>526</th>
      <td>Verdi</td>
      <td>Sierra</td>
      <td>92</td>
      <td>4853.0</td>
      <td>3019</td>
      <td>43107</td>
      <td>0.112580</td>
    </tr>
  </tbody>
</table>
<p>1438 rows × 7 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="many-to-many-joins">
<h3>Many-to-many joins<a class="headerlink" href="#many-to-many-joins" title="Permalink to this headline">¶</a></h3>
<p>Recall that, assuming a one-to-one correspondence between the individuals in the two tables, joining the columns of the two tables requires two steps:</p>
<ol class="simple">
<li><p>sorting each table by their respective join-keys (i.e. lining them up),</p></li>
<li><p>iterating through the (common, corresponding) rows of each table, combining the attributes of each row into a new table.</p></li>
</ol>
<p>Now, consider if one, or both, of the tables contains duplicate values in the column specified as the join-key. How does step 2 change? Sketch out an algorithm. How many rows does the resulting joined table have?</p>
</div>
<div class="section" id="broadcast-join">
<h3>Broadcast join<a class="headerlink" href="#broadcast-join" title="Permalink to this headline">¶</a></h3>
<p>When one of the tables being joined is small, it’s faster to use a <strong>broadcast join</strong>. Broadcast joins use the following procedure:</p>
<ol class="simple">
<li><p>load the small table into a dictionary <span class="math notranslate nohighlight">\(D\)</span>, keyed by the join-key.</p></li>
<li><p>iterate through the large table; for each row <span class="math notranslate nohighlight">\(r\)</span> in the table:</p>
<ol class="simple">
<li><p>access the join key <span class="math notranslate nohighlight">\(k\)</span> for that row,</p></li>
<li><p>get the value <span class="math notranslate nohighlight">\(v = D[k]\)</span> corresponding to this key,</p></li>
<li><p>append the value <span class="math notranslate nohighlight">\(v\)</span> from the dictionary to the row <span class="math notranslate nohighlight">\(r\)</span>.</p></li>
</ol>
</li>
</ol>
<p>This procedure is fast:</p>
<ul class="simple">
<li><p>it doesn’t require sorting <em>either</em> table,</p></li>
<li><p>dictionary lookups only require constant time,</p></li>
</ul>
<p>So this sorting algorithm runs in a time proportional to the sum of the lengths of the two tables.</p>
<p><strong>Example:</strong> Given the two tables of streaming music purchases (<code class="docutils literal notranslate"><span class="pre">purchases</span></code>), and the prices of each plan type (<code class="docutils literal notranslate"><span class="pre">prices</span></code>), one can use a broadcast join to combine the two tables on ‘Plan Type’:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Plan Type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">purchases</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">purchases</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">D</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Plan Type&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="approximate-join">
<h3>Approximate join<a class="headerlink" href="#approximate-join" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/05"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="appending-data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Combining Data: Observations</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="permutation-tests.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Permutation Tests</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Aaron Fraenkel<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>